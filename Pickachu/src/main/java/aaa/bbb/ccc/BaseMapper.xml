<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="aaa.bbb.ccc.BaseMapper">
  <select id="selectPost" resultType="aaa.bbb.ccc.entity.Post" parameterType="aaa.bbb.ccc.entity.Post">
    select * from Post where postId = #{postId}

  </select>
  
  <select id="allPost" resultType="aaa.bbb.ccc.entity.Post">
    select * from Post order by postId desc
  </select>
  
  <select id="searchPost" resultType="aaa.bbb.ccc.entity.Post" parameterType="String">
  	<bind name="search" value="'%' + _parameter + '%'" />
    select * from Post where instaId like #{search} or description like #{search} order by postId desc
  </select>
  
  <insert id="writePost" parameterType="aaa.bbb.ccc.entity.Post">
 	insert into Post (instaId, description, Post.create)
 	values (#{instaId}, #{description}, now()) 
  </insert>
  
  <update id="updatePost" parameterType="aaa.bbb.ccc.entity.Post">
  	update Post set instaId = #{instaId}, description = #{description} where postId= #{postId}
  </update>
  
  <delete id="deletePost" parameterType="Integer">
  	delete from Post where postId = #{postId}
  </delete>
  
	<insert id="writeReply" parameterType="aaa.bbb.ccc.entity.Reply" useGeneratedKeys="true" keyProperty="replyId">
		insert into Reply (instaId, description, Reply.created, postId)
 		values (#{instaId}, #{description}, now(), #{postId}) 
 	</insert>
  
	<select id="repliesForAPost" resultType="aaa.bbb.ccc.entity.Reply" parameterType="Integer">
		select * from Reply where postId = #{postId} AND reReplyId is null order by replyId desc
	</select>  

	<select id="selectReply" resultType="aaa.bbb.ccc.entity.Reply" parameterType="aaa.bbb.ccc.entity.Reply">
    select * from Reply where replyId = #{replyId} 
  	</select>

  <update id="updateReply" parameterType="aaa.bbb.ccc.entity.Reply">
  	update Reply set instaId = #{instaId}, description = #{description} where replyId= #{replyId}
  </update>
  
   <delete id="deleteReply" parameterType="Integer">
  	delete from Reply where replyId = #{replyId}
  </delete>
  
  	<select id="reReplyList" resultType="aaa.bbb.ccc.entity.Reply" parameterType="Integer">
		select * from Reply where reReplyId = #{replyId} order by replyId desc
	</select>  
  
  	<insert id="writeReReply" parameterType="aaa.bbb.ccc.entity.Reply" >
		insert into Reply (instaId, description, Reply.created, postId, reReplyId)
 		values (#{instaId}, #{description}, now(), #{postId}, #{reReplyId}) 
 	</insert>
 	
 	
	<select id="totalSize" resultType="Integer">
		select count(*) from Post
	</select>  
 	
 	<select id="totalSizeSearched" resultType="Integer" parameterType="String">
	<bind name="search1" value="'%' + _parameter + '%'" />
		select count(*) from Post where instaId like #{search1} or description like #{search1}
	</select>  
 	
 	<select id="showPostByPage" resultType="aaa.bbb.ccc.entity.Post" parameterType="aaa.bbb.ccc.entity.PageManager" >
		select * from Post order by PostId desc limit #{pageSize} offset #{currentPage} 
	</select> 
  	
  	<select id="searchPostByPage" resultType="aaa.bbb.ccc.entity.Post" parameterType="aaa.bbb.ccc.entity.PageManager">
		<bind name="search1" value="'%' + _parameter.search + '%'" />
		select * from Post where instaId like #{search1} or description like #{search1} order by PostId desc limit #{pageSize} offset #{currentPage} 
	</select> 
  
    <insert id="signUp" parameterType="aaa.bbb.ccc.entity.Member">
 	insert into Member (eMailMember, penName, passwordMember, createdMember)
 	values (#{eMailMember}, #{penName}, #{passwordMember}, now()) 
  	</insert>
  
  	<select id="penNameCounter" parameterType="String" resultType="Integer">
  	    select count(*) from Member where PenName = #{penName}
  	</select>
  
  	<select id="eMailMemberCounter" parameterType="String" resultType="Integer">
  	    select count(*) from Member where eMailMember = #{eMailMember}
  	</select>
  
</mapper>

